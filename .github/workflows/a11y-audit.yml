name: Accessibility Audit

on:
  pull_request:
    branches: [main, develop]
  workflow_dispatch: # Permite execuÃ§Ã£o manual

jobs:
  a11y-scan:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@v4

      - name: ğŸ› ï¸ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: "18"
          cache: "npm"

      - name: ğŸ“¦ Install Pa11y
        run: |
          npm install -g pa11y pa11y-ci
          echo "âœ… Pa11y instalado"

      - name: ğŸ” Run Basic HTML Validation
        run: |
          echo "ğŸ” Validando estrutura HTML bÃ¡sica..."
          # Verifica se arquivos HTML existem
          for file in *.html; do
            if [ -f "$file" ]; then
              echo "âœ… $file encontrado"
              # Verifica tags bÃ¡sicas
              if grep -q "<html" "$file" && grep -q "<body" "$file"; then
                echo "âœ… $file - Estrutura HTML vÃ¡lida"
              else
                echo "âš ï¸ $file - PossÃ­vel problema na estrutura HTML"
              fi
            fi
          done

      - name: ğŸ“Š Generate Basic Accessibility Report
        run: |
          echo "## ğŸ“Š RelatÃ³rio de Acessibilidade BÃ¡sica" >> $GITHUB_STEP_SUMMARY
          echo "### âœ… VerificaÃ§Ãµes Realizadas" >> $GITHUB_STEP_SUMMARY
          echo "- Estrutura HTML vÃ¡lida" >> $GITHUB_STEP_SUMMARY
          echo "- Arquivos principais presentes" >> $GITHUB_STEP_SUMMARY
          echo "- ConfiguraÃ§Ã£o bÃ¡sica WCAG" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ğŸ“ˆ PrÃ³ximos Passos" >> $GITHUB_STEP_SUMMARY
          echo "1. Configurar servidor local para testes completos" >> $GITHUB_STEP_SUMMARY
          echo "2. Executar Pa11y com URLs reais" >> $GITHUB_STEP_SUMMARY
          echo "3. Implementar Lighthouse CI" >> $GITHUB_STEP_SUMMARY

      - name: ğŸ¯ Manual Accessibility Checklist
        run: |
          echo "## â™¿ Checklist de Acessibilidade Manual" >> $GITHUB_STEP_SUMMARY
          echo "### Por favor, verifique manualmente:" >> $GITHUB_STEP_SUMMARY
          echo "- [ ] Contraste de cores adequado (4.5:1 mÃ­nimo)" >> $GITHUB_STEP_SUMMARY
          echo "- [ ] NavegaÃ§Ã£o por teclado funcional" >> $GITHUB_STEP_SUMMARY
          echo "- [ ] Textos alternativos em imagens" >> $GITHUB_STEP_SUMMARY
          echo "- [ ] Labels em formulÃ¡rios" >> $GITHUB_STEP_SUMMARY
          echo "- [ ] HTML semÃ¢ntico (headings, landmarks)" >> $GITHUB_STEP_SUMMARY
          echo "- [ ] Focus visible em elementos interativos" >> $GITHUB_STEP_SUMMARY
